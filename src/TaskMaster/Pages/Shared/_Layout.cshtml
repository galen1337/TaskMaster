<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>@ViewData["Title"] - TaskMaster</title>
	<script type="importmap"></script>
	<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
	<link rel="stylesheet" href="~/TaskMaster.styles.css" asp-append-version="true" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
	<style>
		html, body { 
			min-height: 100vh; 
			overflow-x: hidden;
			margin: 0;
			padding: 0;
		}
		.sidebar { 
			position: fixed; 
			top: 0; 
			bottom: 0; 
			left: 0; 
			width: 250px; 
			padding: 1.5rem 1rem; 
			background: linear-gradient(180deg, #0d6efd 0%, #0a58ca 100%); 
			color: #fff; 
			display: flex; 
			flex-direction: column; 
			box-shadow: 2px 0 10px rgba(0,0,0,0.1);
			z-index: 1000;
		}
		.sidebar .brand { 
			font-weight: 700; 
			font-size: 1.5rem; 
			display: block; 
			margin-bottom: 2rem; 
			color: #fff !important; 
			text-decoration: none;
			text-align: center;
			padding: 0.5rem;
			border-bottom: 1px solid rgba(255,255,255,0.2);
		}
		.sidebar .nav-link { 
			color: rgba(255,255,255,0.8) !important; 
			padding: 0.75rem 1rem; 
			margin: 0.25rem 0;
			border-radius: 8px; 
			transition: all 0.2s ease;
			display: flex;
			align-items: center;
			text-decoration: none;
		}
		.sidebar .nav-link:hover { 
			background: rgba(255,255,255,0.15); 
			color: #fff !important;
			transform: translateX(4px);
		}
		.sidebar .nav-link.active { 
			background: rgba(255,255,255,0.25); 
			color: #fff !important;
			font-weight: 600;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
		.sidebar .nav-link i { 
			margin-right: 0.75rem; 
			font-size: 1.1rem;
			width: 20px;
			text-align: center;
		}
		.sidebar .main-nav { flex: 1; }
		.sidebar .bottom-nav { 
			margin-top: auto; 
			padding-top: 1rem;
			border-top: 1px solid rgba(255,255,255,0.2);
		}
		.content { 
			margin-left: 250px; 
			min-height: 100vh;
			width: calc(100vw - 250px);
			max-width: calc(100vw - 250px);
			overflow-x: hidden;
		}
		.content .container { 
			max-width: 100%;
			padding-left: 1rem;
			padding-right: 1rem;
		}
		
		/* Responsive design */
		@media (max-width: 768px) {
			.sidebar { 
				width: 200px; 
			}
			.content { 
				margin-left: 200px; 
				width: calc(100vw - 200px);
				max-width: calc(100vw - 200px);
			}
		}
		
		@media (max-width: 576px) {
			.sidebar { 
				width: 180px; 
			}
			.content { 
				margin-left: 180px; 
				width: calc(100vw - 180px);
				max-width: calc(100vw - 180px);
			}
		}
		
		/* Ensure tables and other content don't overflow */
		.table-responsive {
			overflow-x: auto;
		}
		
		.btn {
			white-space: nowrap;
		}
	</style>
</head>
<body>
	<div class="sidebar">
		@if (User.Identity?.IsAuthenticated ?? false)
		{
			<a class="brand" asp-controller="Projects" asp-action="Index">
				<i class="bi bi-kanban"></i> TaskMaster
			</a>
		}
		else
		{
			<a class="brand" asp-area="" asp-page="/Index">
				<i class="bi bi-kanban"></i> TaskMaster
			</a>
		}
		<div class="main-nav">
			<ul class="nav flex-column">
				<li class="nav-item">
					@if (User.Identity?.IsAuthenticated ?? false)
					{
						<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Projects" ? "active" : "")" asp-controller="Projects" asp-action="Index">
							<i class="bi bi-kanban-fill"></i>
							<span>Projects</span>
						</a>
					}
					else
					{
						<a class="nav-link" asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="/Projects">
							<i class="bi bi-kanban-fill"></i>
							<span>Projects</span>
						</a>
					}
				</li>
				@if (User.Identity?.IsAuthenticated ?? false)
				{
					<li class="nav-item">
						<a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Invites" ? "active" : "")" asp-controller="Invites" asp-action="Inbox">
							<i class="bi bi-envelope"></i>
							<span>Inbox</span>
						</a>
					</li>
				}
				<li class="nav-item">
					<a class="nav-link @(ViewContext.RouteData.Values["page"]?.ToString() == "/Privacy" ? "active" : "")" asp-area="" asp-page="/Privacy">
						<i class="bi bi-shield-lock"></i>
						<span>Privacy</span>
					</a>
				</li>
			</ul>
		</div>
		<div class="bottom-nav">
			<partial name="_LoginPartial" />
		</div>
	</div>
	<div class="content">
		<main role="main" class="container py-3">
			@RenderBody()
		</main>
		<footer class="border-top footer text-muted">
			<div class="container">
				&copy; 2025 - TaskMaster - <a asp-area="" asp-page="/Privacy">Privacy</a>
			</div>
		</footer>
	</div>

	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="~/js/site.js" asp-append-version="true"></script>

	<script>
		(function(){
			const success = '@(TempData["Success"] as string)';
			const error = '@(TempData["Error"] as string)';
			if (success) {
				Swal.fire({ toast: true, position: 'top-end', timer: 1500, timerProgressBar: true, icon: 'success', title: success, showConfirmButton: false });
			}
			if (error) {
				Swal.fire({ toast: true, position: 'top-end', timer: 3500, timerProgressBar: true, icon: 'error', title: error, showConfirmButton: false });
			}
		})();
	</script>

	@await RenderSectionAsync("Scripts", required: false)
</body>
</html>
